<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Sender</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-envelope text-blue-600 mr-3"></i>
                Email Sender
            </h1>
            <p class="text-gray-600">Send professional emails with HTML content</p>
        </div>

        <!-- Main Form -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <form id="emailForm" class="space-y-6">
                <!-- Recipient Section -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-user text-blue-600 mr-2"></i>
                        Recipient Information
                    </h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Recipient Email *
                            </label>
                            <input type="email" id="to_email" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="recipient@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Recipient Name
                            </label>
                            <input type="text" id="to_name"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="John Doe">
                        </div>
                    </div>
                </div>

                <!-- Sender Section -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-paper-plane text-blue-600 mr-2"></i>
                        Sender Information
                    </h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                From Name
                            </label>
                            <input type="text" id="from_name"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Your Name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Credential ID
                            </label>
                            <input type="text" id="cred_id"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Enter credential ID (optional)">
                        </div>
                    </div>
                </div>

                <!-- Email Content Section -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-edit text-blue-600 mr-2"></i>
                        Email Content
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Subject *
                            </label>
                            <input type="text" id="subject" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Enter email subject">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Preheader Text
                            </label>
                            <input type="text" id="preheader"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Preview text that appears in email clients">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Email Message *
                            </label>
                            <!-- Replaced HTML textarea with simple text editor and formatting tools -->
                            <div class="border border-gray-300 rounded-md">
                                <div class="bg-gray-50 px-3 py-2 border-b border-gray-300 flex gap-2">
                                    <button type="button" onclick="formatText('bold')" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Bold">
                                        <i class="fas fa-bold"></i>
                                    </button>
                                    <button type="button" onclick="formatText('italic')" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Italic">
                                        <i class="fas fa-italic"></i>
                                    </button>
                                    <button type="button" onclick="formatText('underline')" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Underline">
                                        <i class="fas fa-underline"></i>
                                    </button>
                                    <button type="button" onclick="insertLink()" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Insert Link">
                                        <i class="fas fa-link"></i>
                                    </button>
                                </div>
                                <div id="body_editor" contenteditable="true" 
                                    class="w-full px-3 py-2 min-h-[200px] focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="Type your message here... Use the buttons above to format text."
                                    style="white-space: pre-wrap;">
                                </div>
                            </div>
                            <p class="text-sm text-gray-500 mt-1">
                                Use the formatting buttons above to style your text. No HTML knowledge required!
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Quick Templates -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-magic text-blue-600 mr-2"></i>
                        Quick Templates
                    </h2>
                    <div class="grid md:grid-cols-4 gap-3">
                        <button type="button" onclick="loadTemplate('welcome')"
                            class="px-4 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors">
                            Welcome Email
                        </button>
                        <button type="button" onclick="loadTemplate('newsletter')"
                            class="px-4 py-2 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors">
                            Newsletter
                        </button>
                        <button type="button" onclick="loadTemplate('notification')"
                            class="px-4 py-2 bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 transition-colors">
                            Notification
                        </button>
                        <button type="button" onclick="loadTemplate('sway')"
                            class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200 transition-colors">
                            SWAY Template
                        </button>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button type="submit" id="sendButton"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200 flex items-center justify-center mx-auto">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Send Email
                    </button>
                </div>
            </form>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="hidden rounded-lg p-4 mb-6"></div>

        <!-- Response Display -->
        <div id="responseDisplay" class="hidden bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Response</h3>
            <pre id="responseContent" class="bg-gray-100 p-4 rounded-md text-sm overflow-x-auto"></pre>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://api.sway.mailer.cmctradevault.com/api/mail';

        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('body_editor').focus();
        }

        function insertLink() {
            const url = prompt('Enter the URL:');
            if (url) {
                document.execCommand('createLink', false, url);
                document.getElementById('body_editor').focus();
            }
        }

        function convertToHTML(text) {
            // Convert the rich text editor content to proper HTML
            let html = text;
            
            // Convert line breaks to <br> tags
            html = html.replace(/\n/g, '<br>');
            
            // Wrap in a basic container div
            html = `<div style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">${html}</div>`;
            
            return html;
        }

        // Email templates - Updated templates to use simpler content for the rich text editor
        const templates = {
            welcome: {
                subject: 'Welcome to Our Platform!',
                preheader: 'Thank you for joining us',
                body_text: `Welcome!

Thank you for joining our platform. We're excited to have you on board!

Getting Started:
• Complete your profile
• Explore our features  
• Connect with other users

If you have any questions, feel free to reach out to our support team.

Best regards,
The Team`
            },
            newsletter: {
                subject: 'Monthly Newsletter - Latest Updates',
                preheader: 'Check out what\'s new this month',
                body_text: `Monthly Newsletter

Here are the latest updates and news from our team:

Feature Updates
We've added several new features to improve your experience...

Community Highlights  
See what our amazing community has been up to this month...

Thank you for being part of our community!`
            },
            notification: {
                subject: 'Important Notification',
                preheader: 'Action required on your account',
                body_text: `⚠️ Important Notification

This is an important notification regarding your account.

Action Required:
• Update your account information
• Verify your email address
• Review security settings

Please take action within the next 7 days to avoid any service interruption.

If you have questions, contact our support team immediately.`
            },
            sway: {
                subject: 'SWAY Markets – Important Update',
                preheader: 'Important information regarding your SWAY Markets account',
                body_text: `Important Update from SWAY Markets

Dear Valued Customer,

We hope this message finds you well. We are writing to inform you about an important update regarding your SWAY Markets account.

What's Changing:
• Enhanced security features
• Improved user interface
• New trading tools and analytics

These updates will take effect soon. No action is required on your part, and your account will continue to function normally.

If you have any questions or concerns, please don't hesitate to contact our support team at support@swaymarkets.com.

Thank you for choosing SWAY Markets.

Best regards,
The SWAY Markets Team`
            }
        };

        function loadTemplate(templateName) {
            const template = templates[templateName];
            if (template) {
                document.getElementById('subject').value = template.subject;
                document.getElementById('preheader').value = template.preheader;
                document.getElementById('body_editor').innerText = template.body_text.trim();
                showStatus('Template loaded successfully!', 'success');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `rounded-lg p-4 mb-6 ${type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' : 'bg-red-100 text-red-800 border border-red-200'}`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 5000);
        }

        function showResponse(response) {
            const responseDiv = document.getElementById('responseDisplay');
            const responseContent = document.getElementById('responseContent');
            responseContent.textContent = JSON.stringify(response, null, 2);
            responseDiv.classList.remove('hidden');
        }

        document.getElementById('emailForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const sendButton = document.getElementById('sendButton');
            const originalText = sendButton.innerHTML;
            
            // Show loading state
            sendButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending...';
            sendButton.disabled = true;
            
            try {
                const editorContent = document.getElementById('body_editor').innerHTML;
                const bodyHtml = convertToHTML(editorContent);
                
                // Collect form data
                const formData = {
                    to_email: document.getElementById('to_email').value,
                    to_name: document.getElementById('to_name').value || undefined,
                    subject: document.getElementById('subject').value,
                    body_html: bodyHtml,
                    preheader: document.getElementById('preheader').value || undefined,
                    from_name: document.getElementById('from_name').value || undefined,
                    cred_id: document.getElementById('cred_id').value || undefined
                };

                // Remove undefined values
                Object.keys(formData).forEach(key => {
                    if (formData[key] === undefined) {
                        delete formData[key];
                    }
                });

                // Send request
                const response = await axios.post(`${API_BASE_URL}/send-simple`, formData, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                showStatus('Email sent successfully!', 'success');
                showResponse(response.data);
                
            } catch (error) {
                console.error('Error sending email:', error);
                const errorMessage = error.response?.data?.message || error.message || 'Failed to send email';
                showStatus(`Error: ${errorMessage}`, 'error');
                
                if (error.response?.data) {
                    showResponse(error.response.data);
                }
            } finally {
                // Reset button
                sendButton.innerHTML = originalText;
                sendButton.disabled = false;
            }
        });

        document.getElementById('body_editor').addEventListener('focus', function() {
            if (this.innerText.trim() === '') {
                this.innerHTML = '';
            }
        });

        document.getElementById('body_editor').addEventListener('blur', function() {
            if (this.innerText.trim() === '') {
                this.innerHTML = '<span style="color: #9ca3af;">Type your message here... Use the buttons above to format text.</span>';
            }
        });

        // Initialize placeholder
        document.getElementById('body_editor').innerHTML = '<span style="color: #9ca3af;">Type your message here... Use the buttons above to format text.</span>';
    </script>
</body>
</html>
